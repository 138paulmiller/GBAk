#!/bin/bash
# Paul Miller
#
# Installs:
# - GBAk path to home bashrc
# - Creates a script to generate multiple PNGs into a directory (png2h)
# - Tools by Ian Finlayson
# 	- GBA Map Editor (gba-tileeditor)
#	- Png to Header utilitty (png2gba)
if [ -z "$GBAK" ]; then
	GBAK=$(pwd)
	sudo echo export GBAK="$GBAK" >> ~/.bashrc
fi
mkdir $GBAK/tools 
cd $GBAK/tools
git clone https://github.com/IanFinlayson/gba-tileeditor.git
cd gba-tileeditor
sudo apt-get install qt5-default clang
qmake gba-tileeditor.pro
make
cd ..
git clone https://github.com/IanFinlayson/png2gba.git
cd png2gba
sudo apt-get install clang libpng-dev exuberant-ctags
make
cd ../..
echo $'#!/bin/bash
# Paul Miller - autogenerated script by tool installer script	
# This script is used to convert a PNG to a C-array using png2gba and move the 	
# generated header file into the include directory	
# DO NOT move this script without updating location of PNG2GBA	
if [ $# -gt 1 ]; then	
	WD=${PWD};	
	P2G=$WD/tools/png2gba/png2gba 
	DEST=$WD/$1;
	for IMG in ${@:2}; do
		# move to avoid directory in header vars
		DIR=$(dirname $IMG) 
		BASE=$(basename $IMG)
		cd $DIR
		echo ${PWD}
		# gen header file
		if [ -t $(sudo $P2G -t -p $BASE) ]; then
			# substitute .png ext with .h 
			HEADER=$(sudo echo $BASE | sed -e "s/.png/.h/g")
			sudo mv $HEADER $DEST
			echo Converted $DIR/$BASE to $DEST/$HEADER		
		else
			echo "FAILED"
		fi
	done;
else
 echo Usage ./png2h destination img0.png [img1.png ... ]
fi' > png2h
sudo chmod +x png2h
echo $'gbak Tools
- Tile editor to create C arrays from an image
	./gba-tileeditor/gba-tileeditor
- Generates a palleted C array from PNG image
	./png2gba/png2gba -t -p img.png' > README
