#!/bin/bash
# Paul Miller
#
# Installs:
# - GBAk path to home bashrc
# - Creates a script to generate multiple PNGs into a directory (png2h)
# - Tools by Ian Finlayson
# 	- GBA Map Editor (gba-tileeditor)
#	- Png to Header utilitty (png2gba)
GBAK=$(pwd)
if [ -z "$GBAK" ]; then
	sudo echo export $GBAK >> ~/.bashrc
fi
mkdir $GBAK/tools 
cd $GBAK/tools
git clone https://github.com/IanFinlayson/gba-tileeditor.git
cd gba-tileeditor
sudo apt-get install qt5-default clang
qmake gba-tileeditor.pro
make
cd ..
git clone https://github.com/IanFinlayson/png2gba.git
cd png2gba
sudo apt-get install clang libpng-dev exuberant-ctags
make
cd ..
echo $'#!/bin/bash
# Paul Miller - autogenerated script by tool installer script	
# This script is used to convert a PNG to a C-array using png2gba and move the 	
# generated header file into the include directory	
# DO NOT move this script without updating location of PNG2GBA	
if [ $# -gt 1 ]; then	
	HOME=${PWD};	
	DEST=$HOME/$1;
	for IMG in ${@:2}; do
		cd $(dirname $IMG);
		BASE=$(basename $IMG)
		# gen header file
		$PNG2GBA -t -p $BASE;
		# substitute .png ext with .h 
		HEADER=$(echo $BASE | sed -e "s/.png/.h/g")
		mv $HEADER $DEST
		echo generated $HEADER into $DEST		
		cd $HOME	
	done;
else
 echo Usage ./gen_img destination img0.png [img1.png ... ]
fi' > png2h
sudo chmod +x png2h
echo $'gbak Tools
- Tile editor to create C arrays from an image
	./gba-tileeditor/gba-tileeditor
- Generates a palleted C array from PNG image
	./png2gba/png2gba -t -p img.png' > README
